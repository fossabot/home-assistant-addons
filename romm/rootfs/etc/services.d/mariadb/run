#!/usr/bin/with-contenv bashio
# ==============================================================================
# Home Assistant Add-on: Romm
# Runs MariaDB
# ==============================================================================

bashio::log.info "Starting MariaDB..."

# Initialize database if first run
if [ ! -d /data/mysql/mysql ]; then
    bashio::log.info "Initializing MariaDB database..."
    mysql_install_db --user=root --datadir=/data/mysql --skip-test-db
fi

# Start MariaDB
exec mysqld \
    --datadir=/data/mysql \
    --user=root \
    --bind-address=127.0.0.1 \
    --port=3306 \
    --skip-networking=0 \
    --log-error=/data/mysql/error.log \
    --pid-file=/var/run/mysqld/mysqld.pid
